%table.team-table.table.table-bordered.table-striped.table-hover
  %thead
    %tr
      %td{ :style => 'width: 400px;'}
        Players
      %td{ :style => 'width: 80px;'}
        Kills
      %td{ :style => 'width: 80px;'}
        Assists
      %td{ :style => 'width: 80px;'}
        K/D Ratio
      %td{ :style => 'width: 80px;'}
        Penalties
      %td{ :style => 'width: 100px;'}
        Rank

  %tbody
    - @sorted_players.each do |player|
      %tr
        %td
          - unless player['IsGuest']
            .team-player-flair{ :style => "background-color: #262626; background-image: url('#{I343ApiH4.asset_url_generator_basic(player['EmblemImageUrl']['BaseUrl'], player['EmblemImageUrl']['AssetUrl'], '48')}');"}
          - else
            .team-player-flair{ :style => "background-color: #262626; background-image: url('https://emblems.svc.halowaypoint.com/h4/emblems/steel_brick_recruit-on-silver_plus?size=48');"}

          .team-player-name
            - unless player['IsGuest']
              %a.player-linker{ :playerid => Digest::MD5.hexdigest(player['Gamertag']), 'data-popup' => "pop-#{Digest::MD5.hexdigest(player['Gamertag'])}", :id => Digest::MD5.hexdigest(player['Gamertag']), :href => "/halo4/servicerecord/#{player['Gamertag']}/" }
                - if player['Gamertag'] == @service_record['Gamertag']
                  %span.gamer-tag{ :style => 'font-weight: 600;' }
                    #{player['Gamertag']}
                - else
                  %span.gamer-tag
                  #{player['Gamertag']}

              - if player['Gamertag'] == @service_record['Gamertag']
                %br/
                %span.service-tag{ :style => 'font-weight: 600;' }
                  #{player['Servicetag']}
              - else
                %br/
                %span.service-tag
                  #{player['Servicetag']}
            -else
              %span.gamer-tag
                #{player['Gamertag']}
              %br/
              %span.service-tag
                #{player['ServiceTag']}

          - unless player['IsGuest']
            .team-player-csr{ :style => "background-image: url('#{csr_image_from_raw_csr(player['SkillRank'], 'small')}');"}
          - else
            .team-player-csr{ :style => "background-image: url('https://assets.halowaypoint.com/games/h4/csr/v1/small/0.png');"}

          .cleaner

        %td
          #{player['Kills']}

        %td
          #{player['Assists']}

        %td
          #{calculate_ratio(player['Kills'], player['Deaths'])}

        %td
          #{(player['Betrayals'] + player['Suicides'])}

        %td
          - unless player['IsGuest']
            .team-player-rank{ :style => "background-image: url('#{I343ApiH4.asset_url_generator_basic(player['RankUrl']['BaseUrl'], player['RankUrl']['AssetUrl'], 'medium')}')"}
          - else
            .team-player-rank{ :style => "background-image: url('https://assets.halowaypoint.com/games/h4/ranks/v1/medium/sr-001.png')"}
